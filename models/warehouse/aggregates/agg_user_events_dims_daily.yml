version: 2

models:
  - name: agg_user_events_dims_daily
    description: |
      Purpose: User daily activity aggregated across all dimensional contexts for flexible aggregation.
      Granularity: One row per user per day per unique dimensional context (district, program, resource, application, user role).
      Filters: None (uses int_users_district_role_date which handles event filtering).
      Notes: Uses temporally accurate user attributes (role, district, invite status) as of each event date via int_users_district_role_date.
             Dynamically generates boolean activity flags for all event categories. Supports flexible time grain aggregation through semantic modeling.
    # tests:

    columns:
      - name: user_daily_context_sk
        description: Surrogate key uniquely identifying each user-day-context combination
        tests:
          - unique
          - not_null

      # Dimensional context columns (ordered to match SQL output)
      - name: user_id
        description: "{{ doc('user_id') }}"
        tests:
          - not_null

      - name: server_event_date
        description: "{{ doc('server_event_date') }}"
        tests:
          - not_null

      - name: district_id
        description: "{{ doc('district_id') }}"

      - name: program_id
        description: "{{ doc('program_id') }}"

      - name: resource_id
        description: "{{ doc('resource_id') }}"

      - name: application_name
        description: "{{ doc('application_name') }}"

      - name: event_category
        description: "{{ doc('event_category') }}"

      - name: user_role
        description: "{{ doc('user_role') }}"

      - name: user_invite_status
        description: "{{ doc('user_invite_status') }}"

      - name: match_type
        description: "Indicates whether the user record was matched via 'exact' SCD logic or 'fallback' temporal proximity. Used for data quality monitoring."

      # Dynamically generated activity flag columns
      # Note: These columns are generated dynamically based on event categories in the seed data
      # The pattern is: had_[category]_activity_per_user_day_context

