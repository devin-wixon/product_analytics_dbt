version: 2

models:
  - name: fct_user_activity_periods
    description: |
      Purpose: User activity aggregated to daily level for efficient per-user analysis and distribution calculations.
      Granularity: One row per user per day with activity.
      Filters: Users with at least one event on the date.
      Notes: Optimized for per-user averages, distributions, and cross-dimensional analysis.
    columns:
      - name: user_id
        description: "{{ doc('user_id') }}"
        tests:
          - not_null
      - name: activity_date
        description: "Date of user activity"
        tests:
          - not_null
      - name: programs_accessed
        description: "Count of distinct programs accessed by this user on this date"
      - name: programs_with_planner
        description: "Count of distinct programs accessed via planner by this user on this date"
      - name: resources_accessed
        description: "Count of distinct resources accessed by this user on this date"
      - name: videos_accessed
        description: "Count of distinct video resources accessed by this user on this date"
      - name: documents_accessed
        description: "Count of distinct document resources accessed by this user on this date"
      - name: total_events
        description: "Total number of events for this user on this date"
      - name: login_events
        description: "Number of login events for this user on this date"
      - name: planner_events
        description: "Number of planner open events for this user on this date"
      - name: weekly_planner_events
        description: "Number of weekly planner events for this user on this date"
      - name: app_launch_events
        description: "Number of app launch events for this user on this date"
      - name: sessions
        description: "Count of distinct sessions for this user on this date"
      - name: active_minutes
        description: "Minutes between first and last event for this user on this date"
    
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - user_id
            - activity_date