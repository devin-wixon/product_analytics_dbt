version: 2

models:
  - name: int_user_activity_daily_all_dimensions
    description: |
      Purpose: User daily activity aggregated across all dimensional contexts for flexible aggregation.
      Granularity: One row per user per day per unique dimensional context (district, program, resource, application).
      Filters: Limited to 100 rows in Development environment.
      Notes: Dynamically generates boolean activity flags for all event categories. Supports flexible time grain aggregation through semantic modeling.
    # tests:
      # - dbt_utils.unique_combination_of_columns:
      #     combination_of_columns:
      #       - user_id
      #       - client_event_date
      #       - district_id
      #       - program_id
      #       - resource_id
      #       - application_name
    columns:
      - name: user_daily_context_pk
        description: Surrogate key uniquely identifying each user-day-context combination
        tests:
          - unique
          - not_null

      # - name: n_events_per_user_day_context
      #   description: Total count of events for this user on this day within this dimensional context
      #   tests:
      #     - not_null

      # - name: had_events_per_user_day_context
      #   description: Boolean flag (always 1) indicating the user had activity in this context on this day
      #   tests:
      #     - not_null
      #     - accepted_values:
      #         values: [1]

      # Dimensional context columns (ordered to match SQL output)
      - name: user_id
        description: "{{ doc('user_id') }}"
        tests:
          - not_null

      - name: client_event_date
        description: "{{ doc('client_event_date') }}"
        tests:
          - not_null

      - name: district_id
        description: "{{ doc('district_id') }}"

      - name: program_id
        description: "{{ doc('program_id') }}"

      - name: resource_id
        description: "{{ doc('resource_id') }}"

      - name: application_name
        description: "{ doc('application_name') }"

      # Dynamically generated activity flag columns
      # Note: These columns are generated dynamically based on event categories in the seed data
      # The pattern is: had_[category]_activity_per_user_day_context

