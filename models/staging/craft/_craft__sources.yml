version: 2

sources:
  - name: craft
    description: >
      "Tables extracted from the Craft Postgres database.
      Tables are overwritten daily and may have changes and deletes.
      For some sources, snapshots are used prior to staging to track changes at the extract cadence, daily."
    database: raw
    schema: postgres_extracts
    tables:
      - name: raw_craft__programs
        description: "Programs within Lilypad such as Toddler Joyful Discoveries"
        data_tests:
          - elementary.schema_changes:
              arguments:
                config:
                  severity: warn
                  enabled: "{{ target.name == 'prod' }}"
                tags: ["elementary"]
        columns:
          - name: id
            data_tests:
              - unique
              - not_null
          - name: phase
            data_tests:
              - accepted_values:
                  arguments:
                    values: ['Draft', 'Deprecated', 'Active', 'Phase-Out']
      - name: raw_craft__resources
        description: "Resources such as activities, documents, audio and video"
        # rare updates expected; 30 day threshold
        freshness:
          warn_after: {count: 30, period: day}
          error_after: {count: 30, period: day}
        loaded_at_field: updated_at
        data_tests:
          - elementary.schema_changes:
              arguments:
                config:
                  severity: warn
                  enabled: "{{ target.name == 'prod' }}"
                tags: ["elementary"]
        columns:
          - name: id
            data_type: integer
            data_tests:
              - unique
              - not_null
          # used for snapshot; ensure not null for SCD
          - name: updated_at
            data_tests:
              - not_null
          - name: type
            data_tests:
              - accepted_values:
                  arguments:
                    values: ['activity', 'audio', 'book', 'document', 'image', 'text', 'video', 'web link']
