version: 2

sources:
  - name: craft
    description: >
      "Tables extracted from the Craft Postgres database.
      Tables are overwritten daily and may have changes and deletes.
      For some sources, snapshots are used prior to staging to track changes at the extract cadence, daily."
    database: raw
    schema: postgres_extracts
    tables:
      - name: raw_craft__programs
        description: "Programs within Lilypad such as Toddler Joyful Discoveries"
        tests:
          - elementary.schema_changes:
              arguments:
                config:
                  severity: warn
                tags: ["elementary"]
        columns:
          - name: id
            data_type: integer
            tests:
              - unique
              - not_null
          - name: name
            data_type: varchar
          - name: description
            data_type: text
          - name: age_group
            data_type: varchar
          - name: supplemental
            data_type: boolean
          - name: custom_banner
            data_type: varchar
          - name: deleted_at
            data_type: timestamp
          - name: clone_status
            data_type: varchar
          - name: type
            data_type: varchar
          - name: tags
            data_type: varchar
          - name: district_auto_add
            data_type: boolean
          - name: language
            data_type: varchar
          - name: license_type
            data_type: varchar
          - name: release_date
            data_type: date
          - name: phase
            data_type: varchar
          - name: market_specific
            data_type: boolean
          - name: is_demo
            data_type: boolean

      - name: raw_craft__resources
        description: "Resources such as activities, documents, audio and video"
        tests:
          - elementary.schema_changes:
              arguments:
                config:
                  severity: warn
                tags: ["elementary"]
        columns:
          - name: id
            data_type: integer
            tests:
              - unique
              - not_null
          - name: folder_id
            data_type: integer
          - name: program_id
            data_type: integer
          - name: author_id
            data_type: integer
          - name: type
            data_type: varchar
          - name: code
            data_type: varchar
          - name: title
            data_type: varchar
          - name: description
            data_type: text
          - name: file_url
            data_type: varchar
          - name: section_title
            data_type: varchar
          - name: link
            data_type: varchar
          - name: is_legacy
            data_type: boolean
          - name: short_description
            data_type: varchar
          - name: order_number
            data_type: integer
          - name: thumbnail_mobile_url
            data_type: varchar
          - name: thumbnail_web_url
            data_type: varchar
          - name: downloadable
            data_type: boolean
          - name: provider_id
            data_type: integer
          - name: is_public
            data_type: boolean
          - name: uuid
            data_type: varchar
          - name: focus_area
            data_type: varchar
          - name: publication_status
            data_type: varchar
          - name: publication_origin_id
            data_type: integer
          - name: focus_area_id
            data_type: integer
          - name: sub_focus_area_id
            data_type: integer
          - name: estimated_time
            data_type: varchar
          - name: physical_reference
            data_type: varchar
          - name: physical_page_number
            data_type: varchar
          - name: fts_title
            data_type: varchar
          - name: editor_id
            data_type: integer
          - name: created_at
            data_type: timestamp
          # used for snapshot; ensure not null for SCD
          - name: updated_at
            data_type: timestamp
            tests:
              - not_null
