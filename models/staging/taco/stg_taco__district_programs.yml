version: 2

models:
  - name: stg_taco__district_programs
    description: |
      Purpose: Snapshot of district-program mappings from the taco database with column typing and renaming.  
      Granularity: Full SCD2 history. one row per record id per snapshot, defined by `dbt_scd_id`.  
      Source tests for uniqueness of `district_id` x `program_id` combination.
    columns:
      # this sk will have dups due to snapshots; will be unique in _current
      - name: district_program_id_sk
        data_tests:
          - not_null
      # source tests for non-null district_id, program_id
      # source tests for unique district_id x program_id combination
      - name: district_id
        description: "{{ doc('district_id') }}"
        data_tests:
          - relationships:
              arguments:
                to: ref('stg_taco__districts')
                field: district_id
                where: "dbt_valid_to IS NULL"
      - name: program_id
        data_tests:
          - relationships:
              arguments:
                to: ref('stg_craft__programs')
                field: program_id
                where: "dbt_valid_to IS NULL"
      - name: updated_at_utc
        description: "{{ doc('updated_at_utc') }}"
      - name: dbt_scd_id
        description: "{{ doc('dbt_scd_id') }}"
        data_tests:
          - unique
          - not_null
      - name: dbt_valid_from
        description: "{{ doc('dbt_valid_from') }}"
      - name: dbt_valid_to
        description: "{{ doc('dbt_valid_to') }}"
      - name: dbt_updated_at
        description: "{{ doc('dbt_updated_at') }}"
      - name: dbt_is_deleted
        description: "{{ doc('dbt_is_deleted') }}"
