# Generated by scripts/generate_saved_queries.py
# Purpose: Dynamically generated saved queries for BI export (ex: Tableau) parameterization
# Generates Queries for all time grains × single dimension x 2-dimension combinations

version: 2

saved_queries:

  # Day × All (no dimensional breakdown)
  - name: sq_day_all
    description: "Metrics by day and All (no dimensional breakdown)"
    query_params:
      metrics:
        - n_active_users
        - n_events
      group_by:
        - TimeDimension('event__metric_time_day', 'day')
    exports:
      - name: qexptbl_day_all
        config:
          export_as: table
          schema: "{{ 'exports' if target.name == 'prod' else target.schema }}"
          alias: qexptbl_day_all

  # Day × Program name
  - name: sq_day_program_name
    description: "Metrics by day and Program name"
    query_params:
      metrics:
        - n_active_users
        - n_events
      group_by:
        - TimeDimension('event__metric_time_day', 'day')
        - Dimension('program__program_name')
    exports:
      - name: qexptbl_day_program_name
        config:
          export_as: table
          schema: "{{ 'exports' if target.name == 'prod' else target.schema }}"
          alias: qexptbl_day_program_name

  # Day × Resource type
  - name: sq_day_resource_type
    description: "Metrics by day and Resource type"
    query_params:
      metrics:
        - n_active_users
        - n_events
      group_by:
        - TimeDimension('event__metric_time_day', 'day')
        - Dimension('resource__resource_type')
    exports:
      - name: qexptbl_day_resource_type
        config:
          export_as: table
          schema: "{{ 'exports' if target.name == 'prod' else target.schema }}"
          alias: qexptbl_day_resource_type

  # Week × All (no dimensional breakdown)
  - name: sq_week_all
    description: "Metrics by week and All (no dimensional breakdown)"
    query_params:
      metrics:
        - n_active_users
        - n_events
      group_by:
        - TimeDimension('event__metric_time_week', 'week')
    exports:
      - name: qexptbl_week_all
        config:
          export_as: table
          schema: "{{ 'exports' if target.name == 'prod' else target.schema }}"
          alias: qexptbl_week_all

  # Week × Program name
  - name: sq_week_program_name
    description: "Metrics by week and Program name"
    query_params:
      metrics:
        - n_active_users
        - n_events
      group_by:
        - TimeDimension('event__metric_time_week', 'week')
        - Dimension('program__program_name')
    exports:
      - name: qexptbl_week_program_name
        config:
          export_as: table
          schema: "{{ 'exports' if target.name == 'prod' else target.schema }}"
          alias: qexptbl_week_program_name

  # Month × All (no dimensional breakdown)
  - name: sq_month_all
    description: "Metrics by month and All (no dimensional breakdown)"
    query_params:
      metrics:
        - n_active_users
        - n_events
      group_by:
        - TimeDimension('event__metric_time_month', 'month')
    exports:
      - name: qexptbl_month_all
        config:
          export_as: table
          schema: "{{ 'exports' if target.name == 'prod' else target.schema }}"
          alias: qexptbl_month_all

  # Month × Program name
  - name: sq_month_program_name
    description: "Metrics by month and Program name"
    query_params:
      metrics:
        - n_active_users
        - n_events
      group_by:
        - TimeDimension('event__metric_time_month', 'month')
        - Dimension('program__program_name')
    exports:
      - name: qexptbl_month_program_name
        config:
          export_as: table
          schema: "{{ 'exports' if target.name == 'prod' else target.schema }}"
          alias: qexptbl_month_program_name

  # Day × Program name × Resource type
  - name: sq_day_program_name_resource_type
    description: "Metrics by day and Program name × Resource type"
    query_params:
      metrics:
        - n_active_users
        - n_events
      group_by:
        - TimeDimension('event__metric_time_day', 'day')
        - Dimension('program__program_name')
        - Dimension('resource__resource_type')
    exports:
      - name: qexptbl_day_program_name_resource_type
        config:
          export_as: table
          schema: "{{ 'exports' if target.name == 'prod' else target.schema }}"
          alias: qexptbl_day_program_name_resource_type