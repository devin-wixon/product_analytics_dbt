semantic_models:
  - name: sem_events
    description: |
      Purpose: Event-level data for flexible metric calculation with full dimensional access.
      Granularity: One row per event.
      Filters: None
      Notes: Provides maximum flexibility for cross-dimensional analysis (users x districts x resources x programs).
    model: ref('fct_events')
    defaults:
      agg_time_dimension: client_event_date
    
    entities:
      - name: event
        type: primary
        expr: event_id

      - name: user
        type: foreign
        expr: user_id

      - name: resource
        type: foreign
        expr: resource_id
        
      - name: program
        type: foreign
        expr: program_id
      # - name: session
      #   type: foreign
      #   expr: session_uuid
    
    dimensions:
      # entities are needed as dimensions to filter values
      # or to group by (ex: event count per user)
      - name: program_id
        type: categorical
        description: "{{ doc('program_id') }}"
      - name: user_id
        type: categorical
        description: "{{ doc('user_id') }}"
      - name: resource_id
        type: categorical
        description: "{{ doc('resource_id') }}"
      # date related
      # - name: server_event_date
      #   type: time
      #   description: "{{ doc('server_event_date') }}"
      #   type_params:
      #     time_granularity: day
      - name: client_event_date
        type: time
        description: "{{ doc('client_event_date') }}"
        type_params:
          time_granularity: day
      # other attributes
      - name: event_name
        type: categorical
        description: "{{ doc('event_name') }}"

      - name: event_path
        type: categorical
        description: "{{ doc('event_path') }}"

      - name: launched_application_name
        type: categorical
        description: "{{ doc('launched_application_name') }}"
        expr: launched_application_name
        
      # booleans

    
    measures:
      - name: n_events
        description: ""
        agg: count
        expr: event_id
      - name: n_users_with_any_event
        description: "Count of unique users with an event"
        agg: count_distinct
        expr: user_id
      # - name: n_sessions
      #   description: "Count of unique sessions"
      #   agg: count_distinct
      #   expr: session_uuid

      # counts of resources, programs, apps
      - name: n_resources_accessed
        description: "Count of unique resources accessed"
        agg: count_distinct
        expr: resource_id
      - name: n_programs_accessed
        description: "Count of unique programs accessed"
        agg: count_distinct
        expr: program_id
      - name: n_applications_launched
        description: "Count of unique applications launched"
        agg: count_distinct
        expr: launched_application_name

      
      # counts of events
      # - name: login_events
      #   description: "Count of login events"
      #   agg: count
      #   expr: event_id
      #   filter: |
      #     is_login_event = true