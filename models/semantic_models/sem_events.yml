semantic_models:
  - name: sem_events
    description: |
      Purpose: Event-level data for flexible metric calculation with full dimensional access.  
      Granularity: One row per event.  
      Filters: None. 
      Notes: Provides maximum flexibility for cross-dimensional analysis (users x districts x resources x programs).  
    model: ref('fct_events')
    # client_event_date is going to be the date base for the date spine
    defaults:
      agg_time_dimension: client_event_date
    
    entities:
    # event_id is the primary key
      - name: event
        type: primary
        expr: event_id

      - name: user
        type: foreign
        expr: user_id

      - name: resource
        type: foreign
        expr: resource_id

      - name: district
        type: foreign
        expr: district_id

      - name: program
        type: foreign
        expr: program_id

      # - name: session
      #   type: foreign
      #   expr: session_uuid
    
    dimensions:
      # entities are needed as dimensions to filter values
      # or to group by 
      - name: program_id
        type: categorical
        description: "{{ doc('program_id') }}"

      - name: user_id
        type: categorical
        description: "{{ doc('user_id') }}"

      - name: resource_id
        type: categorical
        description: "{{ doc('resource_id') }}"

      - name: district_id
        type: categorical
        description: "{{ doc('district_id') }}"

    # other attributes
      - name: event_name
        type: categorical
        description: "{{ doc('event_name') }}"

      # - name: event_path
      #   type: categorical
      #   description: "{{ doc('event_path') }}"

      - name: launched_application_name
        type: categorical
        description: "{{ doc('launched_application_name') }}"
        expr: launched_application_name
        
      # booleans

      # date related
      - name: client_event_date
        type: time
        description: "{{ doc('client_event_date') }}"
        type_params:
          time_granularity: day
          

      # - name: server_event_date
      #   type: time
      #   description: "{{ doc('server_event_date') }}"
      #   type_params:
      #     time_granularity: day
    
    measures:
      - name: n_events
        description: ""
        agg: count
        expr: event_id

      - name: n_users_with_any_event
        description: "Count of unique users with any type of event"
        agg: count_distinct
        expr: user_id

      # - name: n_sessions
      #   description: "Count of unique sessions"
      #   agg: count_distinct
      #   expr: session_uuid

      # counts of resources, programs, apps
      - name: n_resources_accessed
        description: "Count of unique resources accessed"
        agg: count_distinct
        expr: resource_id

      - name: n_programs_accessed
        description: "Count of unique programs accessed"
        agg: count_distinct
        expr: program_id

      - name: n_applications_launched
        description: "Count of unique applications (third party products such as Cognitive Toy Box) launched"
        agg: count_distinct
        expr: application_name

      
      # counts of events
      # - name: login_events
      #   description: "Count of login events"
      #   agg: count
      #   expr: event_id
      #   filter: |
      #     is_login_event = true