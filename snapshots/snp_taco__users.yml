snapshots:
  - name: snp_taco__users
    relation: source('taco', 'raw_taco__users')
    config:
      schema: snapshots
      unique_key: id
      strategy: timestamp
      updated_at: date_last_modified
      # hard_deletes new_record will add a dbt_is_deleted column and track deletes
      # see: https://docs.getdbt.com/reference/resource-configs/hard-deletes 
      hard_deletes: new_record
      # sets valid_to date for current rows
      dbt_valid_to_current: to_date('9999-12-31')
      # snapshot_meta_column_names:
        # dbt_is_deleted: is_deleted
    description: >
      Purpose: Snapshot of raw_taco__users with SCD2 tracking.  

      Granularity: `id` x `dbt_valid_from` or `dbt_scd_id`.  

      Notes:  

      - Adds columns such as `dbt_valid_from`, `dbt_valid_to`, and `is_deleted`.  

      - `valid_to` is set to 9999-12-31 for current rows.
    columns:
      - name: id
        description: "{{ doc('user_id') }}"
      - name: sourced_id
        description: "{{ doc('user_sourced_id') }}"
      - name: grades
        description: "{{ doc('user_grades') }}"
      - name: identifier
        description: "{{ doc('user_identifier') }}"
      - name: role
        description: "{{ doc('role') }}"
      - name: status
        description: "{{ doc('user_status') }}"
      - name: username
        description: "{{ doc('username') }}"
      - name: okta_user_id
        description: "{{ doc('okta_user_id') }}"
      - name: class_id
        description: "{{ doc('class_id') }}"
      - name: email_sent
        description: "{{ doc('user_email_sent') }}"
      - name: district_id
        description: "{{ doc('district_id') }}"
      - name: date_last_modified
        description: "{{ doc('date_last_modified') }}"
      - name: phone
        description: "{{ doc('phone') }}"
      - name: other_grades
        description: "{{ doc('user_other_grades') }}"
      - name: invite_status
        description: "{{ doc('user_invite_status') }}"
      - name: disable_auto_sync
        description: "{{ doc('disable_auto_sync') }}"
      - name: manually_added
        description: "{{ doc('manually_added') }}"
      - name: contact_email
        description: "{{ doc('user_contact_email') }}"
      - name: override_district_auth
        description: "{{ doc('override_district_auth') }}"
      - name: role_id
        description: "{{ doc('role_id') }}"
      - name: settings
        description: "{{ doc('user_settings') }}"
      - name: state_id
        description: "{{ doc('user_state_id') }}"
      - name: dbt_scd_id
        description: "{{ doc('dbt_scd_id') }}"
      - name: dbt_updated_at
        description: "{{ doc('dbt_updated_at') }}"
      - name: dbt_valid_from
        description: "{{ doc('dbt_valid_from') }}"
      - name: dbt_valid_to
        description: "{{ doc('dbt_valid_to') }}"
      - name: dbt_is_deleted
        description: "{{ doc('dbt_is_deleted') }}"
